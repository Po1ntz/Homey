# Some characters need to be escaped
# $ -> \u0024
# " -> \u0022
execute if score @s wp.count = WP.MAX wp.count run tellraw @s {"text":"You already have 20 waypoints. Remove a waypoint in order to add a new one","color":"red"}
execute if score @s wp.count = WP.MAX wp.count run return fail


$execute as @s[nbt={Dimension:"minecraft:overworld"}] run data modify storage homey:waypoints template set value {"type":"minecraft:multi_action_input_form","title":"Add Waypoint","can_close_with_escape":true,"inputs":[{"type":"minecraft:text","key":"name","label":"Name","initial":"$(name)"},{"type":"minecraft:text","key":"x","label":"X","initial":"$(x)"},{"type":"minecraft:text","key":"y","label":"Y","initial":"$(y)"},{"type":"minecraft:text","key":"z","label":"Z","initial":"$(z)"},{"type":"minecraft:text","key":"rot1","label":"Rot 1","initial":"$(rot1)"},{"type":"minecraft:text","key":"rot2","label":"Rot2","initial":"$(rot2)"}],"actions":[{"label":"Add","tooltip":"Add a new waypoint to the list","id":"submit","on_submit":{"type":"minecraft:command_template","template":"data modify storage homey:waypoints $(id).actions append value {label:\u0022\u0024(name)\u0022,on_click:{action:\u0022run_command\u0022,command:\u0022execute in minecraft:overworld run tp @s \u0024(x) \u0024(y) \u0024(z) \u0024(rot1) \u0024(rot2)\u0022}}"}}]}
$execute as @s[nbt={Dimension:"minecraft:the_end"}] run data modify storage homey:waypoints template set value {"type":"minecraft:multi_action_input_form","title":"Add Waypoint","can_close_with_escape":true,"inputs":[{"type":"minecraft:text","key":"name","label":"Name","initial":"$(name)"},{"type":"minecraft:text","key":"x","label":"X","initial":"$(x)"},{"type":"minecraft:text","key":"y","label":"Y","initial":"$(y)"},{"type":"minecraft:text","key":"z","label":"Z","initial":"$(z)"},{"type":"minecraft:text","key":"rot1","label":"Rot 1","initial":"$(rot1)"},{"type":"minecraft:text","key":"rot2","label":"Rot2","initial":"$(rot2)"}],"actions":[{"label":"Add","tooltip":"Add a new waypoint to the list","id":"submit","on_submit":{"type":"minecraft:command_template","template":"data modify storage homey:waypoints $(id).actions append value {label:\u0022\u0024(name)\u0022,on_click:{action:\u0022run_command\u0022,command:\u0022execute in minecraft:the_end run tp @s \u0024(x) \u0024(y) \u0024(z) \u0024(rot1) \u0024(rot2)\u0022}}"}}]}
$execute as @s[nbt={Dimension:"minecraft:the_nether"}] run data modify storage homey:waypoints template set value {"type":"minecraft:multi_action_input_form","title":"Add Waypoint","can_close_with_escape":true,"inputs":[{"type":"minecraft:text","key":"name","label":"Name","initial":"$(name)"},{"type":"minecraft:text","key":"x","label":"X","initial":"$(x)"},{"type":"minecraft:text","key":"y","label":"Y","initial":"$(y)"},{"type":"minecraft:text","key":"z","label":"Z","initial":"$(z)"},{"type":"minecraft:text","key":"rot1","label":"Rot 1","initial":"$(rot1)"},{"type":"minecraft:text","key":"rot2","label":"Rot2","initial":"$(rot2)"}],"actions":[{"label":"Add","tooltip":"Add a new waypoint to the list","id":"submit","on_submit":{"type":"minecraft:command_template","template":"data modify storage homey:waypoints $(id).actions append value {label:\u0022\u0024(name)\u0022,on_click:{action:\u0022run_command\u0022,command:\u0022execute in minecraft:the_nether run tp @s \u0024(x) \u0024(y) \u0024(z) \u0024(rot1) \u0024(rot2)\u0022}}"}}]}

scoreboard players add @s wp.count 2
$function homey:waypoints/map_waypoint {"id":$(id), "count":$(count)}
$execute store result storage homey:waypoints $(id).count int 1 run scoreboard players get @s wp.count


function homey:waypoints/register with storage homey:waypoints